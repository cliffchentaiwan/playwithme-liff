<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆç‚ºé™ªç©å“¡</title>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; background-color: #f8f9fa; padding: 20px; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background-color: #06c755; color: white; border: none; border-radius: 25px; font-size: 16px; font-weight: bold; margin-top: 20px; }
        .avatar { width: 80px; height: 80px; border-radius: 50%; display: block; margin: 0 auto 20px; }
    </style>
</head>
<body>
    <div id="loading">è®€å–è³‡æ–™ä¸­...</div>
    <div id="form-container" style="display:none;">
        <img id="my-avatar" class="avatar" src="">
        <h2 style="text-align:center;" id="my-name"></h2>
        
        <div class="form-group">
            <label>è¨­å®šæ‚¨çš„è²»ç‡ (æ¯å°æ™‚)</label>
            <input type="number" id="rate" placeholder="ä¾‹å¦‚ï¼š350">
        </div>
        <div class="form-group">
            <label>å°ˆé•·æ¨™ç±¤ (ç”¨é€—è™Ÿéš”é–‹)</label>
            <input type="text" id="tags" placeholder="ä¾‹å¦‚ï¼š#ç•«ç•«, #é‹¼ç´, #ä¼´è®€">
        </div>
        <div class="form-group">
            <label>è‡ªæˆ‘ä»‹ç´¹ (ç°¡å–®ä¸€å¥è©±)</label>
            <textarea id="intro" rows="3" placeholder="ä¾‹å¦‚ï¼šæˆ‘æ˜¯å¹¼æ•™ç³»å­¸ç”Ÿï¼Œå–œæ­¡è¬›æ•…äº‹..."></textarea>
        </div>
        <button onclick="register()">ç¢ºèªè¨»å†Š / æ›´æ–°è³‡æ–™</button>
    </div>

    <script>
        const LIFF_ID = "2008808827-DzeTt84n"; 
        // ğŸ‘‡ å·²ç¶“å¹«æ‚¨æ›ä¸Šæœ€æ–°çš„ç¶²å€äº†
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwBLO3480Hv5WZs_j7zjUZUvaflboGRyo0_TW94XpQnJo6Uhez7NA_xgSiGxrvDP4LJ/exec";

        let profile = null;

        async function main() {
            try {
                await liff.init({ liffId: LIFF_ID });
                if (!liff.isLoggedIn()) { liff.login(); return; }
                profile = await liff.getProfile();
                
                document.getElementById("loading").style.display = "none";
                document.getElementById("form-container").style.display = "block";
                document.getElementById("my-avatar").src = profile.pictureUrl;
                document.getElementById("my-name").innerText = "Hi, " + profile.displayName;
            } catch (err) {
                alert("åˆå§‹åŒ–å¤±æ•—ï¼š" + err);
            }
        }

        function register() {
            const rate = document.getElementById("rate").value;
            const tags = document.getElementById("tags").value;
            const intro = document.getElementById("intro").value;

            if(!rate || !intro) { alert("è«‹å¡«å¯«å®Œæ•´è³‡è¨Š"); return; }

            const data = {
                action: "register",
                userId: profile.userId,
                displayName: profile.displayName,
                pictureUrl: profile.pictureUrl,
                rate: rate,
                tags: tags,
                intro: intro
            };

            const btn = document.querySelector("button");
            btn.innerText = "è™•ç†ä¸­...";
            btn.disabled = true;

            fetch(SCRIPT_URL, {
                method: "POST",
                body: JSON.stringify(data)
            }).then(() => {
                alert("âœ… è¨»å†ŠæˆåŠŸï¼æ‚¨ç¾åœ¨å¯ä»¥åœ¨å·¥ä½œå°æŒ‰ã€Œä¸Šç·šã€æ¥å–®äº†ã€‚");
                liff.closeWindow();
            }).catch(err => {
                alert("éŒ¯èª¤ï¼š" + err);
                btn.innerText = "ç¢ºèªè¨»å†Š / æ›´æ–°è³‡æ–™";
                btn.disabled = false;
            });
        }
        main();
    </script>
</body>
</html>
