<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Momday 陪玩預約 (家長端)</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body { font-family: sans-serif; background: #f8f9fa; padding: 20px; }
        .worker-card { background: white; border-radius: 16px; padding: 15px; margin-bottom: 12px; display: flex; align-items: center; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .worker-card img { width: 65px; height: 65px; border-radius: 50%; object-fit: cover; margin-right: 15px; border: 2px solid #06C755; }
        .btn-book { margin-left: auto; background: #06C755; color: white; border: none; padding: 10px 20px; border-radius: 10px; font-weight: bold; }
    </style>
</head>
<body>
    <h2 style="color:#333;">找陪玩夥伴</h2>
    <div id="list">正在尋找附近上線中的夥伴...</div>

    <script>
        const LIFF_ID = "2008808827-DzeTt84n";
        const SCRIPT_URL = "在此更換為你的_GAS_URL";
        let profile = null;

        async function init() {
            await liff.init({ liffId: LIFF_ID });
            if (!liff.isLoggedIn()) { liff.login(); return; }
            profile = await liff.getProfile();
            loadWorkers();
        }

        async function loadWorkers() {
            const res = await fetch(SCRIPT_URL, { method: "POST", body: JSON.stringify({ action: "get_workers" }) });
            const result = await res.json();
            const onlineOnes = result.data.filter(w => w.status === "Online");
            document.getElementById('list').innerHTML = onlineOnes.map(w => `
                <div class="worker-card">
                    <img src="${w.photo || 'https://via.placeholder.com/65'}">
                    <div>
                        <div style="font-weight:bold; font-size:16px;">${w.name}</div>
                        <div style="color:#06C755; font-size:14px;">$${w.rate}/hr</div>
                        <div style="color:#888; font-size:12px;">${w.tags || '專業服務'}</div>
                    </div>
                    <button class="btn-book" onclick="book('${w.name}', '${w.rate}')">預約</button>
                </div>
            `).join('') || "目前夥伴都在休息中，請稍後再試。";
        }

        async function book(name, rate) {
            const res = await fetch(SCRIPT_URL, { method: "POST", body: JSON.stringify({ 
                action: "initPayment", userName: profile.displayName, 
                companion: name, price: rate, bookingTime: "自選時段", 
                childInfo: "測試小孩", note: "無" 
            }) });
            const data = await res.json();
            if (data.success) window.location.href = data.paymentUrl;
        }
        init();
    </script>
</body>
</html>
