<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é ç´„é™ªç© - åµéŒ¯æ¨¡å¼</title>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        #debug-log { background: #333; color: #0f0; padding: 15px; border-radius: 10px; font-family: monospace; min-height: 200px; white-space: pre-wrap; font-size: 13px; margin-top: 20px; }
        .btn-retry { padding: 10px 20px; background: #06c755; color: white; border: none; border-radius: 5px; font-size: 16px; margin-top: 10px; }
    </style>
</head>
<body>

    <h2>ğŸ› ï¸ ç³»çµ±è¨ºæ–·ä¸­...</h2>
    <p>å¦‚æœå¡ä½ï¼Œè«‹æˆªåœ–é€™å€‹ç•«é¢çµ¦æˆ‘çœ‹ã€‚</p>
    
    <button class="btn-retry" onclick="location.reload()">é‡æ–°æ•´ç†</button>

    <div id="debug-log">ç­‰å¾…å•Ÿå‹•...</div>

    <div id="list-container"></div>

    <script>
        // ğŸ‘‡ è«‹ç¢ºèªé€™æ˜¯æ‚¨æœ€æ–°çš„ Script ç¶²å€
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwBLO3480Hv5WZs_j7zjUZUvaflboGRyo0_TW94XpQnJo6Uhez7NA_xgSiGxrvDP4LJ/exec";
        const LIFF_ID = "2008808827-DzeTt84n";

        function log(msg) {
            const logBox = document.getElementById("debug-log");
            const time = new Date().toLocaleTimeString();
            logBox.innerText += `[${time}] ${msg}\n`;
            console.log(msg);
        }

        async function main() {
            log("1. é–‹å§‹åˆå§‹åŒ– LIFF...");
            try {
                await liff.init({ liffId: LIFF_ID });
                log("2. LIFF åˆå§‹åŒ–æˆåŠŸ");
                
                if (!liff.isLoggedIn()) {
                    log("3. ç”¨æˆ¶æœªç™»å…¥ï¼Œè·³è½‰ç™»å…¥é ...");
                    liff.login();
                    return;
                }
                
                const profile = await liff.getProfile();
                log("4. å–å¾—ç”¨æˆ¶è³‡æ–™: " + profile.displayName);
                
                loadWorkers();
            } catch (err) {
                log("âŒ LIFF éŒ¯èª¤: " + err);
            }
        }

        async function loadWorkers() {
            log("5. æº–å‚™å‘¼å« Google Script...");
            log("ç¶²å€: " + SCRIPT_URL);
            
            try {
                // æ¸¬è©¦é€£ç·š
                const res = await fetch(SCRIPT_URL + "?action=getWorkers");
                log("6. æ”¶åˆ°å¾Œç«¯å›æ‡‰ï¼Œç‹€æ…‹ç¢¼: " + res.status);
                
                const text = await res.text();
                // æª¢æŸ¥æ˜¯ä¸æ˜¯å›å‚³äº† HTML éŒ¯èª¤é é¢
                if (text.includes("<!DOCTYPE html>") || text.includes("Google Accounts")) {
                    log("âŒ åš´é‡éŒ¯èª¤ï¼šå¾Œç«¯æ¬Šé™ä¸è¶³ï¼");
                    log("è«‹æª¢æŸ¥ Google Script æ˜¯å¦è¨­ç‚ºã€Œä»»ä½•äºº (Anyone)ã€");
                    return;
                }

                log("7. åŸå§‹è³‡æ–™é•·åº¦: " + text.length);
                
                const workers = JSON.parse(text);
                log("8. JSON è§£ææˆåŠŸï¼Œè³‡æ–™ç­†æ•¸: " + workers.length);

                const container = document.getElementById("list-container");
                
                if (workers.length === 0) {
                    log("âš ï¸ è³‡æ–™åº«æ˜¯ç©ºçš„ï¼Œæˆ–æ˜¯æ²’æœ‰äººä¸Šç·š (Online)");
                    container.innerHTML = "<h3>ç›®å‰ç„¡äººä¸Šç·š</h3>";
                } else {
                    log("âœ… æˆåŠŸé¡¯ç¤ºåˆ—è¡¨ï¼");
                    let html = "";
                    workers.forEach(w => {
                        html += `<div style="border:1px solid #ccc; padding:10px; margin:10px 0;">
                            <b>${w.name}</b> ($${w.rate})<br>${w.intro}
                        </div>`;
                    });
                    container.innerHTML = html;
                }

            } catch (err) {
                log("âŒ è®€å–å¤±æ•—: " + err);
                log("å¯èƒ½åŸå› ï¼šè©¦ç®—è¡¨åç¨±éŒ¯èª¤ã€ç¶²å€éŒ¯èª¤ã€æˆ–è³‡æ–™æ ¼å¼å£äº†");
            }
        }

        main();
    </script>
</body>
</html>
