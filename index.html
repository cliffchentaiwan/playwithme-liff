<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é™ªç©æœå‹™æ¸¬è©¦</title>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        body { font-family: "Micirosoft JhengHei", sans-serif; padding: 20px; text-align: center; background-color: #f5f5f5; }
        .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .btn { background-color: #06c755; color: white; border: none; padding: 10px 20px; border-radius: 5px; font-size: 16px; width: 100%; margin-top: 10px; cursor: pointer; }
        .btn:disabled { background-color: #ccc; }
        #status { color: red; font-size: 12px; }
        img { border-radius: 50%; width: 80px; height: 80px; margin-bottom: 10px; }
    </style>
</head>
<body>
    <h2>é™ªç©å¹³å°åŠŸèƒ½æ¸¬è©¦</h2>
    
    <div class="card" id="profileCard">
        <p>æ­£åœ¨è®€å–ä½¿ç”¨è€…è³‡æ–™...</p>
    </div>

    <div class="card">
        <h3>ğŸ“ GPS å®šä½æ¸¬è©¦</h3>
        <p id="geoMsg">ç­‰å¾…æ“ä½œ...</p>
        <button class="btn" onclick="getLocation()">å›å ±ç›®å‰ä½ç½®</button>
    </div>

    <div class="card">
        <h3>ğŸ“¸ çµå–®æƒç¢¼æ¸¬è©¦</h3>
        <p id="scanMsg">è«‹é»æ“Šä¸‹æ–¹æŒ‰éˆ•é–‹å•Ÿç›¸æ©Ÿ</p>
        <button class="btn" id="scanBtn" onclick="scanCode()">é–‹å•Ÿæƒæå™¨</button>
    </div>

    <p id="errorMsg" style="color:red;"></p>

    <script>
        // ä½ çš„ LIFF ID
        const LIFF_ID = "2008808827-DzeTt84n";

        async function main() {
            try {
                await liff.init({ liffId: LIFF_ID });
                if (!liff.isLoggedIn()) {
                    liff.login();
                    return;
                }
                
                // å–å¾—ä½¿ç”¨è€…è³‡æ–™
                const profile = await liff.getProfile();
                document.getElementById("profileCard").innerHTML = `
                    <img src="${profile.pictureUrl}" alt="user">
                    <h3>ä½ å¥½ï¼Œ${profile.displayName}</h3>
                    <p>èº«ä»½é©—è­‰æˆåŠŸ âœ…</p>
                `;

                // æª¢æŸ¥æ˜¯å¦æ˜¯åœ¨ LINE App å…§é–‹å•Ÿ (æƒç¢¼åŠŸèƒ½åªèƒ½åœ¨ LINE App å…§ç”¨)
                if (!liff.isInClient()) {
                    document.getElementById("scanBtn").disabled = true;
                    document.getElementById("scanMsg").innerText = "æƒç¢¼åŠŸèƒ½åƒ…é™æ‰‹æ©Ÿç‰ˆ LINE ä½¿ç”¨";
                }

            } catch (err) {
                document.getElementById("errorMsg").innerText = "åˆå§‹åŒ–å¤±æ•—: " + err.message;
            }
        }

        // æ¸¬è©¦ GPS
        function getLocation() {
            if (!navigator.geolocation) {
                document.getElementById("geoMsg").innerText = "ä½ çš„è£ç½®ä¸æ”¯æ´ GPS";
                return;
            }
            document.getElementById("geoMsg").innerText = "å®šä½ä¸­...";
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    document.getElementById("geoMsg").innerHTML = `å®šä½æˆåŠŸï¼<br>ç·¯åº¦: ${lat}<br>ç¶“åº¦: ${lng}`;
                    // é€™è£¡æœªä¾†æœƒæ¥ä¸Šï¼šå‚³é€è³‡æ–™çµ¦ä¼ºæœå™¨
                },
                (error) => {
                    document.getElementById("geoMsg").innerText = "å®šä½å¤±æ•—ï¼Œè«‹ç¢ºèªæ‰‹æ©Ÿå·²æˆæ¬Š GPS";
                }
            );
        }

        // æ¸¬è©¦æƒç¢¼
        async function scanCode() {
            try {
                const result = await liff.scanCodeV2(); // å‘¼å«æƒæå™¨
                document.getElementById("scanMsg").innerText = "æƒæçµæœ: " + result.value;
            } catch (err) {
                document.getElementById("scanMsg").innerText = "æƒæå¤±æ•—: " + err.message;
                alert("è«‹ç¢ºèªä½ åœ¨ LIFF è¨­å®šä¸­æœ‰é–‹å•Ÿ Scan QR é¸é …ï¼");
            }
        }

        main();
    </script>
</body>
</html>
