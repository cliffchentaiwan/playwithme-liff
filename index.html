<div id="booking-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:999; justify-content:center; align-items:center;">
        <div style="background:white; width:80%; padding:20px; border-radius:15px; position:relative;">
            <h3 id="modal-title">預約確認</h3>
            <p style="font-size:14px; color:#666;">請填寫孩童資訊讓陪玩員先認識喔！</p>
            
            <label style="display:block; margin-top:10px; font-weight:bold;">孩童暱稱/年齡</label>
            <input type="text" id="child-info" placeholder="例如：小寶 5歲" style="width:100%; padding:10px; margin-top:5px; border:1px solid #ddd; border-radius:8px;">
            
            <label style="display:block; margin-top:10px; font-weight:bold;">備註/特殊需求</label>
            <textarea id="booking-note" placeholder="例如：對花生過敏，喜歡畫畫" style="width:100%; padding:10px; margin-top:5px; border:1px solid #ddd; border-radius:8px;"></textarea>
            
            <div style="margin-top:20px; display:flex; gap:10px;">
                <button onclick="closeModal()" style="flex:1; padding:10px; background:#ddd; border:none; border-radius:8px;">取消</button>
                <button onclick="submitBooking()" style="flex:1; padding:10px; background:#06c755; color:white; border:none; border-radius:8px;">確認預約</button>
            </div>
        </div>
    </div>

    <script>
        // ... 原本的 LIFF init 和 loadWorkers 保持不變 ...

        // 新增全域變數來暫存要預約誰
        let selectedWorker = null;
        let selectedPrice = 0;

        // 1. 修改原本的 book 函式：不直接送出，而是打開彈窗
        function book(name, price) {
            selectedWorker = name;
            selectedPrice = price;
            document.getElementById("modal-title").innerText = `預約 ${name}`;
            document.getElementById("booking-modal").style.display = "flex";
        }

        function closeModal() {
            document.getElementById("booking-modal").style.display = "none";
        }

        // 2. 新增確認送出函式
        async function submitBooking() {
            const childInfo = document.getElementById("child-info").value;
            const note = document.getElementById("booking-note").value;
            
            if (!childInfo) { alert("請填寫孩童資料"); return; }

            const btn = document.querySelector("#booking-modal button:last-child");
            btn.innerText = "處理中...";
            btn.disabled = true;

            const data = { 
                action: "book", 
                userName: userProfile.displayName, 
                companion: selectedWorker, 
                price: selectedPrice,
                childInfo: childInfo,
                note: note
            };

            try {
                await fetch(SCRIPT_URL, { method: "POST", body: JSON.stringify(data) });
                alert("✅ 預約申請已送出！等待陪玩員確認。");
                closeModal();
            } catch (err) {
                alert("錯誤：" + err);
            } finally {
                btn.innerText = "確認預約";
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>
